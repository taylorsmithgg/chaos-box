{"version":3,"file":"/packages/dburles:mongo-collection-instances.js","sources":["dburles:mongo-collection-instances/mongo-instances.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA,mB;AACA,4B;;AAEA,4C;AACA,kD;AACA,E;AACA,kB;AACA,e;AACA,mB;AACA,oB;AACA,K;AACA,E;;AAEA,2D;AACA,0D;;AAEA,iC;;AAEA,gD;AACA,0B;AACA,yD;AACA,2B;AACA,sC;AACA,6G;AACA,kC;AACA,K;;AAEA,mB;AACA,mD;;AAEA,6B;AACA,E;;AAEA,sC;AACA,mB;AACA,E;;AAEA,oF;AACA,qC;;AAEA,mB;AACA,kB;AACA,kB;AACA,2B;AACA,sB;AACA,K;AACA,C","sourcesContent":["var instances = [];\nvar orig = Mongo.Collection;\n\nMongo.Collection = function(name, options) {\n  orig.call(this, name, options);  // inherit orig\n  \n  instances.push({\n    name: name,\n    instance: this,\n    options: options\n  });\n};\n\nMongo.Collection.prototype = Object.create(orig.prototype);\nMongo.Collection.prototype.constructor = Mongo.Collection;\n\n_.extend(Mongo.Collection, orig);\n\nMongo.Collection.get = function(name, options) {\n  options = options || {};\n  var collection = _.find(instances, function(instance) {\n    if (options.connection)\n      return instance.name === name &&\n        instance.options && instance.options.connection._lastSessionId === options.connection._lastSessionId;\n    return instance.name === name;\n  });\n\n  if (! collection)\n    throw new Meteor.Error(\"Collection not found\");\n\n  return collection.instance;\n};\n\nMongo.Collection.getAll = function() {\n  return instances;\n};\n\n// Meteor.Collection will lack ownProperties that are added back to Mongo.Collection\nMeteor.Collection = Mongo.Collection;\n\nif (Meteor.users) {\n  instances.push({\n    name: 'users',\n    instance: Meteor.users,\n    options: undefined\n  });\n}\n"]}