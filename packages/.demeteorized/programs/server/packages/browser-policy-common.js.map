{"version":3,"sources":["browser-policy-common/browser-policy-common.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA,mB;;AAEA,mB;;AAEA,0C;AACA,gB;AACA,E;;AAEA,6C;AACA,gB;AACA,E;;AAEA,sD;AACA,yE;AACA,mC;AACA,kB;;AAEA,8C;AACA,wD;AACA,oC;AACA,8C;AACA,sB;AACA,oD;AACA,G;AACA,Y;AACA,kD;AACA,G;AACA,S;AACA,G;;AAEA,mE;AACA,oC;AACA,sE;AACA,oE;AACA,uE;AACA,wC;AACA,yD;AACA,mC;AACA,kB;;AAEA,mD;AACA,qD;AACA,2B;AACA,gE;AACA,G;AACA,S;AACA,G","file":"/packages/browser-policy-common.js","sourcesContent":["BrowserPolicy = {};\n\nvar inTest = false;\n\nBrowserPolicy._runningTest = function () {\n  return inTest;\n};\n\nBrowserPolicy._setRunningTest = function () {\n  inTest = true;\n};\n\nWebApp.connectHandlers.use(function (req, res, next) {\n  // Never set headers inside tests because they could break other tests.\n  if (BrowserPolicy._runningTest())\n    return next();\n\n  var xFrameOptions = BrowserPolicy.framing &&\n        BrowserPolicy.framing._constructXFrameOptions();\n  var csp = BrowserPolicy.content &&\n        BrowserPolicy.content._constructCsp();\n  if (xFrameOptions) {\n    res.setHeader(\"X-Frame-Options\", xFrameOptions);\n  }\n  if (csp) {\n    res.setHeader(\"Content-Security-Policy\", csp);\n  }\n  next();\n});\n\n// We use `rawConnectHandlers` to set X-Content-Type-Options on all\n// requests, including static files.\n// XXX We should probably use `rawConnectHandlers` for X-Frame-Options\n// and Content-Security-Policy too, but let's make sure that doesn't\n// break anything first (e.g. the OAuth popup flow won't work well with\n// a CSP that disallows inline scripts).\nWebApp.rawConnectHandlers.use(function (req, res, next) {\n  if (BrowserPolicy._runningTest())\n    return next();\n\n  var contentTypeOptions = BrowserPolicy.content &&\n        BrowserPolicy.content._xContentTypeOptions();\n  if (contentTypeOptions) {\n    res.setHeader(\"X-Content-Type-Options\", contentTypeOptions);\n  }\n  next();\n});\n"]}