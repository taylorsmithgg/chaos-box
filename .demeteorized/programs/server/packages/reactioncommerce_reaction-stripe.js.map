{"version":3,"sources":["reactioncommerce:reaction-stripe/common/collections.coffee","reactioncommerce:reaction-stripe/common/register.coffee","reactioncommerce:reaction-stripe/common/routing.coffee","reactioncommerce:reaction-stripe/server/stripe.coffee"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,YAAY,CAAC,OAAO,CAAC,mBAArB,GAA+C,iBAAa;EAC1D,YAAY,CAAC,OAAO,CAAC,aADqC,EAE1D;AAAA,IACE,oBACE;AAAA,YAAM,MAAN;AAAA,MACA,OAAO,eADP;KAFJ;GAF0D;CAAb,CAA/C;;AAAA,YASY,CAAC,OAAO,CAAC,aAArB,GAAyC,iBACvC;AAAA,aACE;AAAA,UAAM,MAAN;AAAA,IACA,OAAO,iBADP;GADF;AAAA,EAGA,YACE;AAAA,UAAM,MAAN;AAAA,IACA,KAAK,EADL;AAAA,IAEA,OAAO,aAFP;GAJF;AAAA,EAOA,aACE;AAAA,UAAM,MAAN;AAAA,IACA,KAAK,CADL;AAAA,IAEA,OAAO,kBAFP;GARF;AAAA,EAWA,YACE;AAAA,UAAM,MAAN;AAAA,IACA,KAAK,CADL;AAAA,IAEA,OAAO,iBAFP;GAZF;AAAA,EAeA,KACE;AAAA,UAAM,MAAN;AAAA,IACA,KAAK,CADL;AAAA,IAEA,OAAO,KAFP;GAhBF;CADuC,CATzC;;;;;;;;;;;;;;;;;;;ACAA,YAAY,CAAC,eAAb,CACE;AAAA,QAAM,iBAAN;AAAA,EACA,UAAU,CAAC,eAAD,CADV;AAAA,EAEA,iBAAiB,mBAFjB;AAAA,EAGA,OAAO,QAHP;AAAA,EAIA,aAAa,sCAJb;AAAA,EAKA,MAAM,qBALN;AAAA,EAMA,eAAe,QANf;AAAA,EAOA,WAAW,IAPX;AAAA,EAQA,UAAU,GARV;AAAA,EASA,iBAAiB;IACf;AAAA,MACE,OAAO,iBADT;AAAA,MAEE,YAAY,oBAFd;AAAA,MAGE,OAAO,eAHT;KADe;GATjB;CADF;;;;;;;;;;;;;;;;;;;ACAA,MAAM,CAAC,GAAP,CAAW;SACT,IAAC,MAAD,CAAO,QAAP,EACE;AAAA,gBAAY,mBAAZ;AAAA,IACA,MAAM,2BADN;AAAA,IAEA,UAAU,QAFV;AAAA,IAGA,QAAQ;AACN,aAAO,YAAY,CAAC,aAAa,CAAC,QAAlC,CADM;IAAA,CAHR;GADF,EADS;AAAA,CAAX;;;;;;;;;;;;;;;;;;;ACCA;;AAAA,QAAQ,GAAG,CAAC,OAAJ,CAAY,QAAZ,CAAR;;AAAA,MACA,GAAS,GAAG,CAAC,OAAJ,CAAY,eAAZ,CADT;;AAAA,MAIM,CAAC,OAAP,CAEE;AAAA,gBAAc,SAAC,QAAD,EAAW,WAAX;AAEZ;AAAA,cAAU,YAAY,CAAC,WAAW,CAAC,QAAQ,CAAC,OAAlC,CAA0C;AAAA,YAAM,iBAAN;KAA1C,CAAkE,CAAC,QAAQ,CAAC,OAAtF;AAAA,IACA,SAAS,GAAG,CAAC,OAAJ,CAAY,QAAZ,EAAsB,OAAtB,CADT;AAAA,IAGA,MAAU,YAHV;AAAA,IAIA,IAAC,QAAD,EAJA;AAAA,IAMA,MAAM,CAAC,OAAO,CAAC,MAAf,CACE;AAAA,cAAQ,WAAW,CAAC,MAApB;AAAA,MACA,UAAU,WAAW,CAAC,QADtB;AAAA,MAEA,MAAM,QAFN;KADF,EAIE,SAAC,GAAD,EAAM,OAAN;AACA,UAAG,GAAH;AACE,WAAG,CAAC,QAAD,CAAH,CACE;AAAA,iBAAO,KAAP;AAAA,UACA,OAAO,GADP;SADF,EADF;OAAA;AAKE,WAAG,CAAC,QAAD,CAAH,CACE;AAAA,iBAAO,IAAP;AAAA,UACA,SAAS,OADT;SADF,EALF;OADA;IAAA,CAJF,CANA;WAqBA,GAAG,CAAC,IAAJ,GAvBY;EAAA,CAAd;CAFF,CAJA","file":"/packages/reactioncommerce:reaction-stripe.js","sourcesContent":["ReactionCore.Schemas.StripePackageConfig = new SimpleSchema([\n  ReactionCore.Schemas.PackageConfig\n  {\n    \"settings.api_key\":\n      type: String\n      label: \"API Client ID\"\n  }\n])\n\nReactionCore.Schemas.StripePayment = new SimpleSchema\n  payerName:\n    type: String\n    label: \"Cardholder name\"\n  cardNumber:\n    type: String\n    min: 16\n    label: \"Card number\"\n  expireMonth:\n    type: String\n    max: 2\n    label: \"Expiration month\"\n  expireYear:\n    type: String\n    max: 4\n    label: \"Expiration year\"\n  cvv:\n    type: String\n    max: 4\n    label: \"CVV\"","ReactionCore.registerPackage\n  name: \"reaction-stripe\"\n  provides: ['paymentMethod']\n  paymentTemplate: \"stripePaymentForm\"\n  label: \"Stripe\"\n  description: \"Stripe Payment for Reaction Commerce\"\n  icon: 'fa fa-shopping-cart'\n  settingsRoute: \"stripe\"\n  hasWidget: true\n  priority: \"2\"\n  shopPermissions: [\n    {\n      label: \"Stripe Payments\"\n      permission: \"dashboard/payments\"\n      group: \"Shop Settings\"\n    }\n  ]","Router.map ->\n  @route 'stripe',\n    controller: ShopAdminController\n    path: 'dashboard/settings/stripe',\n    template: 'stripe'\n    waitOn: ->\n      return ReactionCore.Subscriptions.Packages","\nFiber = Npm.require(\"fibers\")\nFuture = Npm.require(\"fibers/future\")\n\n\nMeteor.methods\n  #submit (sale, authorize)\n  stripeSubmit: (cardData, paymentData) ->\n\n    api_key = ReactionCore.Collections.Packages.findOne(name: \"reaction-stripe\").settings.api_key\n    Stripe = Npm.require(\"stripe\")(api_key)\n\n    fut = new Future()\n    @unblock()\n\n    Stripe.charges.create\n      amount: paymentData.amount\n      currency: paymentData.currency\n      card: cardData\n    , (err, payment) ->\n      if err\n        fut.return\n          saved: false\n          error: err\n      else\n        fut.return\n          saved: true\n          payment: payment\n      return\n\n    fut.wait()\n\n"]}