{"version":3,"sources":["reactioncommerce:reaction-braintree/common/collections.coffee","reactioncommerce:reaction-braintree/common/routing.coffee","reactioncommerce:reaction-braintree/common/register.coffee","reactioncommerce:reaction-braintree/server/braintree.coffee"],"names":[],"mappings":"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","file":"/packages/reactioncommerce:reaction-braintree.js","sourcesContent":["ReactionCore.Schemas.BraintreePackageConfig  = new SimpleSchema([\n  ReactionCore.Schemas.PackageConfig\n  {\n    \"settings.merchant_id\":\n      type: String\n      label: \"Merchant ID\"\n\n    \"settings.public_key\":\n      type: String\n      label: \"Public Key\"\n\n    \"settings.private_key\":\n      type: String\n      label: \"Private Key\"\n  }\n])\n\nReactionCore.Schemas.BraintreePayment = new SimpleSchema\n  payerName:\n    type: String\n    label: \"Cardholder name\",\n    regEx: /^\\w+\\s\\w+$/\n  cardNumber:\n    type: String\n    min: 16\n    label: \"Card number\"\n  expireMonth:\n    type: String\n    max: 2\n    label: \"Expiration month\"\n  expireYear:\n    type: String\n    max: 4\n    label: \"Expiration year\"\n  cvv:\n    type: String\n    max: 4\n    label: \"CVV\"\n\nReactionCore.Schemas.BraintreePayment.messages\n  \"regEx payerName\": \"[label] must include both first and last name\"","Router.map ->\n  @route 'braintree',\n    controller: ShopAdminController\n    path: 'dashboard/settings/braintree',\n    template: 'braintree'\n    waitOn: ->\n      return ReactionCore.Subscriptions.Packages","ReactionCore.registerPackage\n  name: \"reaction-braintree\"\n  provides: ['paymentMethod']\n  paymentTemplate: \"braintreePaymentForm\"\n  label: \"Braintree\"\n  description: \"Braintree Payment for Reaction Commerce\"\n  icon: 'fa fa-shopping-cart'\n  settingsRoute: \"braintree\"\n  hasWidget: true\n  priority: \"2\"\n  shopPermissions: [\n    {\n      label: \"Braintree Payments\"\n      permission: \"dashboard/payments\"\n      group: \"Shop Settings\"\n    }\n  ]","Braintree = Npm.require('braintree')\nFiber = Npm.require(\"fibers\")\nFuture = Npm.require(\"fibers/future\")\n\nbraintreePackage = ReactionCore.Collections.Packages.findOne(name: \"reaction-braintree\")\n\nif braintreePackage?.settings\n  ReactionCore.Events.trace {name: \"reactioncommerce:reaction-braintree\", settings: braintreePackage}\n  settings = braintreePackage.settings\n  gateway = Braintree.connect(\n    environment: Braintree.Environment.Sandbox\n    merchantId: settings.merchant_id\n    publicKey: settings.public_key\n    privateKey: settings.private_key\n  )\n\nMeteor.methods\n  braintreeSubmit: (cardData, amount) ->\n    fut = new Future()\n    @unblock()\n\n    gateway.transaction.sale\n      amount: amount\n      creditCard:\n        number: cardData.number\n        expirationMonth: cardData.expirationMonth\n        expirationYear: cardData.expirationYear\n        cvv: cardData.cvv\n      , (err, payment) ->\n        if err\n          fut.return\n            saved: false\n            error: err\n        else if payment.success\n          fut.return\n            saved: true\n            payment: payment\n        else\n          console.log result.message\n        return\n\n        ### Error handling Snippet from braintree docs\n        throw err if err\n        if result.success\n          console.log \"Success. Transaction ID: \" + result.transaction.id\n        else\n          console.log result.message\n        return\n        ###"]}